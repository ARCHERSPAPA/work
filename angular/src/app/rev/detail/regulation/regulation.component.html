<div class="detail-price mt-20 pb-20" *ngIf="(regulars && regulars.length > 0) || (showDetailByState() && list)">
    <nz-table [nzData]="[{title:'数据'}]"  nzLoading="false"
              [nzShowPagination]="false">
        <thead>
        <tr>
            <th style="width:5%;"></th>
            <th colspan="4" style="text-align: left;width:25%;">名称</th>
            <th colspan="2" style="text-align: left;width:15%">应付</th>
            <th colspan="2" style="text-align: left;width:15%">实付</th>
            <th colspan="3" style="text-align: left;width:20%">项目总额</th>
            <th colspan="3" style="text-align: left;width:20%">操作</th>
        </tr>
        </thead>
    </nz-table>
    <!--</nz-table>-->
    <!---历史数据展示--->
    <div *ngIf="regulars && regulars.length > 0">
        <nz-table #regulaTable [nzData]="regulars" [nzFrontPagination]="false"
                  [nzShowPagination]="false">
            <tbody>
            <ng-template ngFor let-data let-last="last" [ngForOf]="regulaTable.data">
                <tr>
                    <td nzShowExpand [(nzExpand)]="data.expand" width="5%"></td>
                    <td colspan="4"  width="25%">{{data.pause && data.pause.name?data.pause.name:'增减项目'}}</td>
                    <!--<td colspan="3">小计：{{getTotal(data.details) > 0?'+':''}}{{getTotal(data.details)|number:'1.2'}}</td>-->
                    <td colspan="2"  width="15%">{{data.pause.applyPrice?(data.pause.applyPrice >
                        0?'+':'')+(data.pause.applyPrice|number:'1.2'):'0.00'}}
                    </td>
                    <td colspan="2"  width="15%">{{data.pause.applyActualPrice?(data.pause.applyActualPrice >
                        0?'+':'')+(data.pause.applyActualPrice |number:'1.2'):'0.00'}}
                    </td>
                    <td colspan="6" *ngIf="!last" width="40%">{{(data.pause.finalPrice?data.pause.finalPrice:0)|number:'1.2'}}</td>
                    <td colspan="3" *ngIf="last"  width="20%">{{(data.pause.finalPrice?data.pause.finalPrice:0)|number:'1.2'}}</td>
                    <td colspan="3" *ngIf="last"  width="20%">
                        <a href="javascript:void(0)" (click)="auditItem(0)" *ngIf="showAuditBtnByState()" style="color:#f5222d">
                            审核不通过
                        </a>
                        <a href="javascript:void(0)" (click)="auditItem(1)" *ngIf="showAuditBtnByState()" class="ml-10">
                            审核通过
                        </a>
                    </td>
                </tr>
                <tr *ngIf="data.details && data.details.length > 0" [nzExpand]="data.expand">
                    <td></td>
                    <td colspan="15">
                        <nz-table #innerTable [nzData]="data.details" [nzFrontPagination]="false"
                                  [nzShowPagination]="false">
            <thead>
            <tr>
                <th>名称</th>
                <th>类别</th>
                <th>品牌</th>
                <th>规格</th>
                <th>型号</th>
                <th>材质</th>
                <th width="10%">颜色</th>
                <th>单位</th>
                <th>单价</th>
                <th>数量</th>
                <th>合计/应收</th>
                <th>实收</th>
                <th *ngIf="state !== 6">说明</th>
                <th *ngIf="state === 6">成本单价</th>
                <th *ngIf="state === 6">成本合计</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let inner Of innerTable.data">
                <td [title]="inner.name?inner.name:''">{{inner.name?inner.name:'--'}}</td>
                <td [title]="inner.category?inner.category:''">{{inner.category?inner.category:'--'}}</td>
                <td [title]="inner.brand?inner.brand:''">{{inner.brand?inner.brand:'--'}}</td>
                <td [title]="inner.specifications?inner.specifications:0">
                    {{inner.specifications?inner.specifications:'--'}}
                </td>
                <td>{{inner.model?inner.model:'--'}}</td>
                <td [title]="inner.material?inner.material:''">{{inner.material?inner.material:'--'}}</td>
                <td *ngIf="inner.colours && inner.colours.length > 0"  width="10%">
                    {{renderColors(inner.colours)[0]}}
                </td>
                <td *ngIf="!inner.colours || inner.colours.length === 0"  width="10%">--</td>
                <td [title]="inner.unit?inner.unit:0">{{inner.unit?inner.unit:'--'}}</td>
                <td [title]="inner.univalent?inner.univalent:0">{{(inner.univalent?inner.univalent:0)|number:'1.2'}}
                </td>
                <td [title]="inner.num?inner.num:0">{{inner.num|number:'1.2'}}</td>
                <td [title]="(inner.univalent?inner.univalent:0)*(inner.num?inner.num:0)">
                    {{converseToDecimal(inner.univalent,inner.num)|number:'1.2'}}
                </td>
                <td>{{(inner.totalPrice?inner.totalPrice:0)|number:'1.2'}}</td>
                <td *ngIf="state !== 6" [nzTitle]="inner.offerExplain?inner.offerExplain:'暂无备注信息'"
                    nzPlacement="topLeft" nz-tooltip>{{inner.offerExplain?inner.offerExplain:'--'}}
                </td>
                <td *ngIf="state === 6">{{(inner.primeCost?inner.primeCost:0)|number:'1.2'}}</td>
                <td *ngIf="state === 6">{{(inner.primetotalPrice?inner.primetotalPrice:0)|number:'1.2'}}</td>
            </tr>
            <tr>
                <td colspan="13" [nzTitle]="data.pause && data.pause.remark?data.pause.remark:'暂无备注信息'"
                    nzPlacement="topLeft" nz-tooltip>备注：{{data.pause && data.pause.remark?data.pause.remark:'暂无备注信息'}}</td>
            </tr>
            </tbody>
        </nz-table>
        </td>
        </tr>
        </ng-template>
        </tbody>
        </nz-table>
    </div>
    <!---当前操作增减项-->
    <div *ngIf="showDetailByState() && list">
        <nz-table [nzFrontPagination]="false" [nzShowPagination]="false"
                  [nzData]="[{title:'当前操作数据'}]">
            <tbody>
            <tr>
                <td nzShowExpand [(nzExpand)]="list.expand" width="5%"></td>
                <td colspan="4" width="25%">{{list.pause && list.pause.name?list.pause.name:'增减项目'}}</td>
                <td colspan="2" width="15%">{{list.pause.applyPrice?(list.pause.applyPrice >
                    0?'+':'')+(list.pause.applyPrice|number:'1.2'):'0.00'}}
                </td>
                <td colspan="2" *ngIf="disableByState(list.pause.state)" width="15%">
                    <input type="text" nz-input style="width:120px;" [(ngModel)]="list.pause.applyActualPrice"
                           revInputDecimal role="4" [pauseId]="list.pause.id" [num]="list.pause.applyActualPrice"/></td>
                <td colspan="2" *ngIf="!disableByState(list.pause.state)" width="15%">
                    {{list.pause.applyActualPrice?(list.pause.applyActualPrice > 0?'+':'')+(list.pause.applyActualPrice
                    |number:'1.2'):'0.00'}}
                </td>
                <td colspan="3" width="20%"
                    *ngIf="!disableByState(list.pause.state)">{{(list.pause.finalPrice?list.pause.finalPrice:0)|number:'1.2'}}</td>
                <td colspan="3" width="20%"
                    *ngIf="disableByState(list.pause.state)">{{getFinalPriceByTime()|number:'1.2'}}</td>
                <td colspan="3" width="20%"></td>
            </tr>
            <tr *ngIf="list.details && list.details.length > 0" [nzExpand]="list.expand">
                <td></td>
                <td colspan="15">
                    <nz-table #innerTable [nzData]="list.details" [nzFrontPagination]="false"
                              [nzShowPagination]="false">
            <thead>
            <tr>
                <th>名称</th>
                <th>类别</th>
                <th>品牌</th>
                <th>规格</th>
                <th>型号</th>
                <th>材质</th>
                <th width="10%">颜色</th>
                <th>单位</th>
                <th>单价</th>
                <th>数量</th>
                <th>合计/应收</th>
                <th>实收</th>
                <th *ngIf="state !== 6">说明</th>
                <th *ngIf="state === 6">成本单价</th>
                <th *ngIf="state === 6">成本合计</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let inner Of innerTable.data">
                <td [title]="inner.name?inner.name:''">{{inner.name?inner.name:'--'}}</td>
                <td [title]="inner.category?inner.category:''">{{inner.category?inner.category:'--'}}</td>
                <td [title]="inner.brand?inner.brand:''">{{inner.brand?inner.brand:'--'}}</td>
                <td [title]="inner.specifications?inner.specifications:0">
                    {{inner.specifications?inner.specifications:'--'}}
                </td>
                <td [title]="inner.modal?inner.modal:''">{{inner.model?inner.model:'--'}}</td>
                <td [title]="inner.material?inner.material:''">{{inner.material?inner.material:'--'}}</td>
                <td *ngIf="inner.colours && inner.colours.length > 0"  width="10%"
                    [title]="renderColors(inner.colours)[0]">
                    <nz-select style="width: 100%;" nzSize="'small'" [ngModel]="renderColors(inner.colours)[0]"
                               (ngModelChange)="selectColorChange($event,inner.id)">
                        <nz-option *ngFor="let color of renderColors(inner.colours)"
                                   [nzLabel]="color" [nzValue]="color">
                        </nz-option>
                    </nz-select>
                </td>
                <td *ngIf="!inner.colours || inner.colours.length === 0"  width="10%">--</td>
                <td [title]="inner.unit?inner.unit:0">{{inner.unit?inner.unit:'--'}}</td>
                <td [title]="inner.univalent?inner.univalent:0">{{(inner.univalent?inner.univalent:0)|number:'1.2'}}
                </td>
                <td [title]="inner.num?inner.num:0">
                    <input type="text" nz-input [(ngModel)]="inner.num"
                           [disabled]="!disableByState(list.pause.state)"
                           revInputDecimal role="2" [id]="inner.id"
                           [pauseId]="list.pause.id" tabindex="{{i}}"
                           [num]="inner.num"
                           (dataEmitter)="renderPause($event)"/>
                </td>
                <td [title]="(inner.univalent?inner.univalent:0)*(inner.num?inner.num:0)">
                    {{converseToDecimal(inner.univalent,inner.num)|number:'1.2'}}
                </td>
                <td *ngIf="inner.infoType === 4">
                    <input type="text" nz-input [(ngModel)]="inner.totalPrice"
                           [disabled]="!disableByState(list.pause.state)"
                           revInputDecimal role="3" [id]="inner.id"
                           [num]="inner.totalPrice"
                           [pauseId]="list.pause.id" (dataEmitter)="renderPause($event)"/>
                </td>
                <td *ngIf="inner.infoType !== 4">{{(inner.totalPrice?inner.totalPrice:0)|number:'1.2'}}</td>
                <td *ngIf="state !== 6" [nzTitle]="inner.offerExplain?inner.offerExplain:'暂无备注信息'"
                    nzPlacement="topLeft" nz-tooltip>{{inner.offerExplain?inner.offerExplain:'--'}}
                </td>
                <td *ngIf="state === 6">{{(inner.primeCost?inner.primeCost:0)|number:'1.2'}}</td>
                <td *ngIf="state === 6">{{(inner.primetotalPrice?inner.primetotalPrice:0)|number:'1.2'}}</td>
                <td><a href="javascript:void(0)" *ngIf="disableByState(list.pause.state)"
                       (click)="delItem(inner.id)">删除</a></td>
            </tr>
            <tr>
                <td colspan="13" class="textarea" *ngIf="disableByState(list.pause.state)">
                    备注：<input type="text" nz-input placeholder="请输入备注信息"
                              [(ngModel)]="list.pause.remark" maxlength="120"
                              style="width: 96%;padding-right: 6%;" (blur)="pauseRemark(list.pause)"/>
                    <span class="count" *ngIf="list.pause.remark && list.pause.remark.length"><span>{{list.pause.remark.length}}</span>/120</span>
                </td>
                <td colspan="13" class="textarea" *ngIf="!disableByState(list.pause.state)">
                    备注：{{list.pause && list.pause.remark?list.pause.remark:'暂无备注'}}
                </td>
            </tr>
            </tbody>
        </nz-table>
        </td>
        </tr>
        </tbody>
        </nz-table>
    </div>
    <div nz-row class="mt-24">
        <div nz-col nzOffset="16" nzSpan="8" class="text-right" *ngIf="showDetailByState() && list">
            <span class="text-blink">项目总额：{{getFinalPriceByTime()|number:'1.2'}}</span>
        </div>
        <div nz-col nzOffset="16" nzSpan="8" class="text-right" *ngIf="!(showDetailByState() && list) && regulars && regulars.length > 0">
            <span class="text-blink">项目总额：{{(regulars[regulars.length-1].pause && regulars[regulars.length-1].pause.finalPrice?regulars[regulars.length-1].pause.finalPrice:0)|number:'1.2'}}</span>
        </div>
    </div>
</div>
<!---显示按钮--->
<!--<nz-affix nzOffsetBottom="50">-->
    <!--<div nz-row class="btn-fix">-->
        <!--<div nz-col nzSpan="24" class="text-right">-->
            <!--<button nz-button nzType="default" (click)="exportSheet(cid)" class="ml-10">导出预算表-->
            <!--</button>-->
            <!--<a class="ant-btn ant-btn-primary ml-10" target="_blank"-->
               <!--[routerLink]="['/view/quote']" [queryParams]="{cid:btoa(cid),aid:btoa(aid)}"-->
               <!--*ngIf="state !== 5">预览</a>-->
            <!--<a class="ant-btn ant-btn-primary ml-10" target="_blank"-->
               <!--[routerLink]="['/view/quote']" [queryParams]="{cid:btoa(cid),aid:btoa(aid)}"-->
               <!--*ngIf="state === 5">预览</a>-->
            <!--<button  nz-popconfirm nzTitle="增项直接提交至客户等待确认?"-->
                     <!--(nzOnConfirm)="submitItem()" nzPlacement="top"-->
                     <!--nz-button nzType="'primary'" class="ml-10"-->
                     <!--[hidden]="!showTipByPrice(list.pause.applyActualPrice,list.ratio)"-->
                    <!--*ngIf="list && list.pause && disableByState(list.pause.state)">提交-->
            <!--</button>-->
            <!--<button  nz-popconfirm nzTitle="减项需提交至公司等待确认?"-->
                     <!--(nzOnConfirm)="submitItem()" nzPlacement="top"-->
                     <!--nz-button nzType="'primary'" class="ml-10"-->
                     <!--[hidden]="showTipByPrice(list.pause.applyActualPrice,list.ratio)"-->
                     <!--*ngIf="list && list.pause && disableByState(list.pause.state) ">提交-->
            <!--</button>-->
        <!--</div>-->
    <!--</div>-->
<!--</nz-affix>-->


<!---审核项目--->
<nz-modal
        [(nzVisible)]="auditVisible"
        nzTitle="审核"
        nzOkText="确定"
        nzCancelText="取消"
        (nzOnCancel)="auditCancel()"
        (nzOnOk)="auditOk()">
    <div class="modify">
        <form [formGroup]="auditForm">
            <nz-form-item>
                <nz-form-label [nzSpan]="6">审核意见</nz-form-label>
                <nz-form-control [nzSpan]="14" class="textarea">
                    <textarea nz-input formControlName="msg" [(ngModel)]="msg"
                              placeholder="请输入审核内容" maxlength="120" rows="4"></textarea>
                    <span class="count" *ngIf="msg && msg.length > 0"><span>{{msg.length}}</span>/120</span>
                </nz-form-control>
            </nz-form-item>
        </form>
    </div>
</nz-modal>